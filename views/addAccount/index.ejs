<!-- Header Section -->
<div class="appHeader">
    <div class="left">
        <a href="/" class="headerButton goBack">
            <ion-icon name="chevron-back-outline"></ion-icon>
        </a>
    </div>
    <div class="pageTitle">Add Account</div>
    <div class="right">
        <a href="app-notifications.html" class="headerButton">
            <ion-icon class="icon" name="notifications-outline"></ion-icon>
            <span class="badge badge-danger">4</span>
        </a>
    </div>
</div>

<!-- App Capsule -->
<div id="appCapsule">

    <input id="hiddenHostName" value="<%- site_root %>" type="hidden" />
        <input id="hiddenApiHostName" value="<%- api_host %>" type="hidden" />
        
    <div class="section mt-2">

        <!-- Tab Navigation -->
        <ul class="nav nav-tabs capsuled mt-1" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#bankAccountTab" role="tab">Bank Account</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#upiAccountTab" role="tab">UPI</a>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content mt-1">

            <!-- Bank Account Tab -->
            <div class="tab-pane fade show active" id="bankNameTab" role="tabpanel">
                <form id="bankNameForm">
                    <div class="section my-4">
                        <h3>Bank Name</h3>
                        <div class="form-group basic" style="margin-top: -12px;">
                            <input type="text" class="form-control" id="bankNameNumber" placeholder="Enter Bank Name" required pattern="\d{9,18}">
                            <div class="clear-input">
                                <ion-icon name="close-circle"></ion-icon>
                            </div>
                            <small class="text-danger d-none" id="bankNameError">Enter a valid account number (9–18 digits).</small>
                        </div>
                    </div>
                    <div class="section my-4">
                        <h3>Bank Account Number</h3>
                        <div class="form-group basic" style="margin-top: -12px;">
                            <input type="text" class="form-control" id="bankAccountNumber" placeholder="Enter Bank Account Number" required pattern="\d{9,18}">
                            <div class="clear-input">
                                <ion-icon name="close-circle"></ion-icon>
                            </div>
                            <small class="text-danger d-none" id="bankAccountError">Enter a valid account number (9–18 digits).</small>
                        </div>
                    </div>
                    <div class="section my-4">
                        <h3>Account Holder Name</h3>
                        <div class="form-group basic" style="margin-top: -12px;">
                            <input type="text" class="form-control" id="accountHolderName" placeholder="Enter Account Holder Name" required>
                            <div class="clear-input">
                                <ion-icon name="close-circle"></ion-icon>
                            </div>
                            <small class="text-danger d-none" id="holderNameError">Name is required.</small>
                        </div>
                    </div>
                    <div class="section my-4">
                        <h3>IFSC Code</h3>
                        <div class="form-group basic" style="margin-top: -12px;">
                            <input type="text" class="form-control" id="ifscCode" placeholder="Enter IFSC Code" required pattern="^[A-Z]{4}0[A-Z0-9]{6}$">
                            <div class="clear-input">
                                <ion-icon name="close-circle"></ion-icon>
                            </div>
                            <small class="text-danger d-none" id="ifscError">Enter a valid IFSC code (e.g. HDFC0001234).</small>
                        </div>
                    </div>
                    <div class="section my-4">
                        <h3>Initial Deposit Amount (Optional)</h3>
                        <div class="form-group basic" style="margin-top: -12px;">
                            <input type="number" class="form-control" id="initialDepositAmount" placeholder="Enter Amount">
                            <div class="clear-input">
                                <ion-icon name="close-circle"></ion-icon>
                            </div>
                        </div>
                    </div>
                    <div class="mt-2 mb-2">
                        <button type="submit" class="btn btn-primary btn-block btn-lg">Add Bank Account</button>
                    </div>
                </form>
            </div>

            <!-- UPI Tab -->
            <div class="tab-pane fade" id="upiAccountTab" role="tabpanel">
                <form id="upiAccountForm">
                    <div class="section my-4">
                        <h3>UPI ID</h3>
                        <div class="form-group basic" style="margin-top: -12px;">
                            <input type="text" class="form-control" id="upiId" placeholder="e.g. username@bank" required pattern="^[a-zA-Z0-9.\-_]{2,256}@[a-zA-Z]{2,64}$">
                            <div class="clear-input">
                                <ion-icon name="close-circle"></ion-icon>
                            </div>
                            <small class="text-danger d-none" id="upiError">Enter a valid UPI ID.</small>
                        </div>
                    </div>
                    <div class="mt-2 mb-2">
                        <button type="submit" class="btn btn-primary btn-block btn-lg">Add UPI Account</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>


    <script src="assets/js/jquery.min.js"></script>

<script>
    document.getElementById("bankAccountForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const bankAccount = document.getElementById("bankAccountNumber").value.trim();
  const holderName = document.getElementById("accountHolderName").value.trim();
  const ifscCode = document.getElementById("ifscCode").value.trim();
  const initialDepositAmount = document.getElementById("initialDepositAmount").value.trim();

  const data = {
    user_id: "1",
    is_upi: "0",
    upi_id: "",
    user_name: holderName,
    account_holder: holderName,
    bank_name: "State bank of america",
    account_number: bankAccount
  };

  const URL = $("#hiddenApiHostName").val() + "/api/bank/add";

  try {
    const response = await fetch(URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
      credentials: 'include'
    });

    if (!response.ok) {
      const err = await response.json();
      throw new Error(err.message || 'Failed to add bank account.');
    }

    alert("Bank account added successfully!");
    this.reset();

  } catch (error) {
    alert("Error: " + error.message);
  }
});

</script>

<!-- CSS for icon-letter -->
<style>
    .icon-letter {
        width: 48px;
        height: 48px;
        border-radius: 100%;
        background-color: #211a41;
        margin-right: 13px;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
        padding-left: 2px;
    }

    .icon-letter-2 {
        width: 48px;
        height: 48px;
        border-radius: 100%;
        background-color: #ba6118;
        margin-right: 13px;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
        padding-left: 2px;
    }

    .text-danger {
        font-size: 0.8rem;
    }
</style>



<script>
    document.getElementById("bankAccountForm").addEventListener("submit", async function (e) {
  e.preventDefault();
  let valid = true;

  const bankAccount = document.getElementById("bankAccountNumber").value.trim();
  const holderName = document.getElementById("accountHolderName").value.trim();
  const ifscCode = document.getElementById("ifscCode").value.trim();
  const initialDepositAmount = document.getElementById("initialDepositAmount").value.trim();


  // Build data matching your API
  const data = {
    user_id: "1",  // example fixed user id or get dynamically
    is_upi: "0",   // 0 for bank account
    upi_id: "",    // empty for bank account
    user_name: holderName, // assuming account holder name as user name here
    account_holder: holderName,
    bank_name: "State bank of america", // hardcoded or input field if you want
    account_number: bankAccount
  };

  try {
    const response = await fetch('http://127.0.0.1:5500/api/bank/add', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        // 'Cookie': 'connect.sid=...'  // normally cookies sent automatically by browser if same origin
      },
      body: JSON.stringify(data),
      credentials: 'include' // include cookies if needed
    });

    if (!response.ok) {
      const err = await response.json();
      throw new Error(err.message || 'Failed to add bank account.');
    }

    alert("Bank account added successfully!");
    this.reset();

  } catch (error) {
    alert("Error: " + error.message);
  }
});

</script>